<polymer-element name="rw-survey-ratings-chart" attributes="ratings entries">
  <template>
    <div id="chart" style="width: 900px; height: 500px;"></div>
  </template>
 <script>
    Polymer('rw-survey-ratings-chart', {
      values: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'],
      entriesChanged: function() {
        this.loadChart();
      },
      loadChart: function() {
        window.google.load("visualization", "1", {
          packages: ["corechart"],
          callback: _.bind(this.drawChart, this)
        });
      },
      drawChart: function() {
        var keys = _.flatten(['Rating', this.values, {role: 'annotation'}]);

        var ratings = _.map(this.ratings, function(rating, index) {
          var values = _.map(this.values, function() { return 0; });
          _.each(this.entries, function(entry) {
            var value = _.indexOf(this.values, entry.ratings[index]);
            values[value] = values[value] + 1;
          }, this);

          return _.flatten([rating, values, '']);
        }, this);

        var data = google.visualization.arrayToDataTable([keys].concat(ratings));

        var options = {
          legend: { position: 'top', maxLines: 3 },
          bar: { groupWidth: '75%' },
          isStacked: true,
        };

        var chart = new google.visualization.BarChart(document.getElementById('chart'));
        chart.draw(data, options);
      }
    });
  </script>
</polymer-element>
